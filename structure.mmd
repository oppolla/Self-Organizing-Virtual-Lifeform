graph TD
    %% Subgraph 1: User Interaction
    subgraph User Interaction
        UI[User Input] -->|Text| GEN[Generate Response]
        GEN -->|Response| UO[User Output]
    end

    %% Subgraph 2: Core Components
    subgraph Core Components
        BT[Base Tokenizer<br><i>Tokens Processing</i>] --> BM[Base Model<br>Frozen]
        ST[Scaffold Tokenizer<br><i>Adaptive Tokens</i>] --> SM[Scaffold Model<br>Trainable]
        BM -->|Hidden States| CAF[Simple Cross-Attention Fuser]
        SM -->|Hidden States| CAF
        CAF -->|Processed States| BM
        CH[Conversation History] --> GEN
        TL[Thread Logger<br>Log Interaction Data] --> GEN
    end

    %% Subgraph 3: Training Subsystem - Sleep Phase
    subgraph Training Subsystem - Sleep Phase
        TS[Training Scheduler] --> RT[Training Runtime Trigger]
        RT --> TE[Training Step]
        TE --> SM[Update Weights]
        DU[Deploy Updates] -->|Production Weights| PS[Production Scaffold]
    end

    %% External Connections
    CH --> IB[Interaction Buffer]
    TL --> IB
    IB --> EMS[External Memory Store]
    EMS --> PT[Prepare Training Data]
    PT --> RT
    PT --> KF[K-Fold Cross Validation]
    KF -->|Split Data| TS

    %% Styling Nodes
    classDef user fill:#f8c3,stroke:#333,stroke-width:1px;
    classDef core fill:#b6c8e5,stroke:#333,stroke-width:1px;
    classDef train fill:#ffd3b6,stroke:#333,stroke-width:1px;
    classDef external fill:#c4f1b1,stroke:#333,stroke-width:1px;
    class UI,UO,GEN user;
    class BT,BM,ST,SM,CAF,CH,TL,PS core;
    class TS,RT,TE,DU train;
    class IB,EMS,PT,KF external;